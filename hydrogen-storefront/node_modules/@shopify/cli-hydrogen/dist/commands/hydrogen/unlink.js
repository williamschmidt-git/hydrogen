import Command from '@shopify/cli-kit/node/base-command';
import { outputWarn, outputSuccess } from '@shopify/cli-kit/node/output';
import { commonFlags } from '../../lib/flags.js';
import { getConfig, unsetStorefront } from '../../lib/shopify-config.js';

class Unlink extends Command {
  static description = "Unlink a local project from a Hydrogen storefront.";
  static hidden = true;
  static flags = {
    path: commonFlags.path
  };
  async run() {
    const { flags } = await this.parse(Unlink);
    await unlinkStorefront(flags);
  }
}
async function unlinkStorefront({ path }) {
  const actualPath = path ?? process.cwd();
  const { storefront: configStorefront } = await getConfig(actualPath);
  if (!configStorefront) {
    outputWarn("This project isn't linked to a Hydrogen storefront.");
    return;
  }
  const storefrontTitle = configStorefront.title;
  await unsetStorefront(actualPath);
  outputSuccess(`You are no longer linked to ${storefrontTitle}`);
}

export { Unlink as default, unlinkStorefront };
